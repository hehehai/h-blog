---
title: ä½¿ç”¨ Docker åˆ›å»º MySQL å®¹å™¨æœåŠ¡
description: ä½¿ç”¨ Docker åˆ›å»º MySQL å®¹å™¨æœåŠ¡
tags: 
  - MySQL
  - Docker
badges: å®è·µ
date: 2022-11-05
---

### Docker ä¸‹è½½

å‰å¾€å®˜ç½‘ä¸‹è½½ Docker https://www.docker.com/

### å®‰è£…

![docker-install](/static/images/use-docker-mysql-server/docker-install.png)

æ‰“å¼€ Docker åï¼Œæˆ‘ä»¬éœ€è¦ç™»å½•è´¦å·ï¼Œæ²¡æœ‰çš„è¯ï¼Œæ³¨å†Œä¸€ä¸‹å°±å¥½

### ä¿®æ”¹å®‰è£…æº

ç‚¹å‡» è®¾ç½® / Docker Engine

![docker-change-registry](/static/images/use-docker-mysql-server/docker-change-registry.png)

```json {10}
{
  "builder": {
    "gc": {
      "defaultKeepStorage": "20GB",
      "enabled": true
    }
  },
  "debug": true,
  "experimental": false,
  "registry-mirrors": ["https://xxxxxx.mirror.aliyuncs.com"]
}
```

è¿™é‡Œæˆ‘å®¤å‹çš„é˜¿é‡Œäº‘çš„ä¸ªäººæºåœ°å€ï¼Œè¿™è¿˜æ˜¯å…è´¹çš„ï¼Œç½‘ä¸Šè¿˜æœ‰å¾ˆå¤šå›½å†…æºï¼Œè‡ªå·±é€‰æ‹©å°±å¥½ã€‚

ä¿®æ”¹å®Œéœ€è¦ç‚¹å‡»å³ä¸‹è§’çš„é‡å¯å°±å¥½ã€‚

### å®‰è£… MySQL

ä½¿ç”¨çš„ Docker Hub Image: https://hub.docker.com/_/mysql

è¿™é‡Œå®‰è£… 8.0 çš„ç‰ˆæœ¬

1. æ‰“å¼€ç»ˆç«¯

```shell
ğŸ¤™  ~ docker --version
Docker version 20.10.20, build 9fdeb9c
```

ä¸¤ä¸ªæ¦‚å¿µ

- images: é•œåƒ

![docker-cli-images](/static/images/use-docker-mysql-server/docker-cli-images.png)

```shell
docker images -a
```

å½“å‰å·²åˆ›å»ºçš„é•œåƒ

- containerï¼šå®¹å™¨

![docker-cli-containers](/static/images/use-docker-mysql-server/docker-cli-containers.png)

```shell
docker ps
dcpker ps -a
```

å½“å‰æ­£åœ¨è¿è¡Œä¸­çš„å®¹å™¨
å½“å‰å…¨éƒ¨çš„å®¹å™¨

![docker-create-mysql-container](/static/images/use-docker-mysql-server/docker-create-mysql-container.png)

```shell
docker run --name mysql -d -p 3306:3306 -e MYSQL_ROOT_PASSWORD=your-pwd -v mysql:/var/lib/mysql --restart unless-stopped mysql:8
```

Unable to find image 'mysql:8' locally è¡¨ç¤ºå½“å‰é•œåƒå†æœ¬åœ°ä¸å­˜åœ¨ï¼Œéœ€è¦åœ¨ è¿œç¨‹ hub ä¸­æŸ¥æ‰¾ï¼ŒåŠä¸‹è½½

![docker-pull-mysql-images](/static/images/use-docker-mysql-server/docker-pull-mysql-images.png)

![docker-pull-mysql-success](/static/images/use-docker-mysql-server/docker-pull-mysql-success.png)

- `docker run`: è¿è¡Œä¸€ä¸ªå®¹å™¨
- `--name mysql`: å®¹å™¨çš„åç§°æ˜¯ mysqlï¼ˆå¯ä»¥è‡ªå·±å®šä¹‰ï¼Œæ²¡æœ‰é™åˆ¶ï¼‰
- `-d`: æ­¤å‘½ä»¤å°†åœ¨åå°è¿è¡Œå®¹å™¨
- `-p 3306:3306`: å®¹å™¨æœåŠ¡çš„ `3306` ç«¯å£å¼€æ”¾åˆ°å®¿ä¸»ç½‘ç»œï¼ˆä½ çš„ç³»ç»Ÿï¼‰æ˜ å°„çš„ç«¯å£æ˜¯ `3306`ï¼ˆè¿™ä¸ªç«¯å£å¯ä»¥è‡ªå·±å¡«å†™ï¼‰
- `-e MYSQL_ROOT_PASSWORD=your-pwd`: ä¸ºå®¹å™¨è®¾ç½®ç¯å¢ƒå˜é‡ï¼Œåç§°ä¸º `MYSQL_ROOT_PASSWORD` è¿™é‡Œä¼šè¢«å†…éƒ¨ä½¿ç”¨ï¼Œä½œä¸º `root` ç”¨æˆ·çš„å¯†ç  `your-pwd` å¯ä»¥è‡ªå®šä¹‰
- `--restart unless-stopped`: æŒ‡ç¤º Docker å§‹ç»ˆå¯ä»¥é‡æ–°å¯åŠ¨å®¹å™¨ï¼Œè‹¥ Docker å®ˆæŠ¤è¿›ç¨‹å‘ç”Ÿé‡æ–°å¯åŠ¨æˆ–æ›´æ–°åï¼Œè¯¥å®¹å™¨è‡ªåŠ¨é‡å¯ã€‚`unless-stop` è¡¨ç¤º `docker stop` åœæ­¢å®¹å™¨æ—¶ï¼Œ Docker å®ˆæŠ¤è¿›ç¨‹çš„é‡å¯å°†ä¸ä¼šå½±å“å®¹å™¨

2. æŸ¥çœ‹å®¹å™¨ä¿¡æ¯

çœ‹ä¸‹å®¹å™¨è¿è¡Œæ—¥å¿—
![docker-logs-mysql](/static/images/use-docker-mysql-server/docker-logs-mysql.png)

è¿™é‡Œ `mysql` æ˜¯å®¹å™¨åç§°

![docker-mysql-info](/static/images/use-docker-mysql-server/docker-mysql-info.png)

![docker-ui-containers](/static/images/use-docker-mysql-server/docker-ui-containers.png)

![docker-ui-images](/static/images/use-docker-mysql-server/docker-ui-images.png)

okï¼Œæˆ‘ä»¬è¿æ¥ä¸‹æ•°æ®åº“

![connect-mysql](/static/images/use-docker-mysql-server/connect-mysql.png)

```shell
docker exec -it mysql mysql -p
```

![docker-exec-mysql-login](/static/images/use-docker-mysql-server/docker-exec-mysql-login.png)

- `docker exec`ï¼šä»¥æ‰§è¡Œçš„æ–¹å¼å‘å®¹å™¨ä¼ é€’ shell
- `-it`: ä»¥äº¤äº’çš„æ–¹å¼
- `mysql`: å®¹å™¨åç§°
- `mysql -p`: åœ¨å®¹å™¨çš„ bash ä¸‹æ‰§è¡Œï¼Œä»¥å¯†ç çš„æ–¹å¼ç™»å…¥ MySQL cli

![docker-mysql-cli](/static/images/use-docker-mysql-server/docker-mysql-cli.png)

![docker-mysql-show-dbs](/static/images/use-docker-mysql-server/docker-mysql-show-dbs.png)

3. ä½¿ç”¨æŒä¹…åŒ–æ•°æ®

æ­¤æ—¶æˆ‘ä»¬å·²ç»å¯ä»¥è¿æ¥ä½¿ç”¨æ•°æ®åº“äº†ï¼Œä½†è¿˜æ²¡æœ‰é…ç½® Docker Volumes (å®¹å™¨æŒä¹…åŒ–å·å®—)ã€‚ä¹Ÿå°±æ˜¯å½“å‰ MySQL çš„ä¹¦å°±æ˜¯è¢«ä¸´æ—¶æŒ‚åœ¨å®¹å™¨é»˜è®¤ä½¿ç”¨çš„è·¯å¾„ä¸Šï¼ˆå®¹å™¨ `<->` å®¿ä¸»è·¯å¾„ï¼‰ï¼Œéšç€å®¹å™¨çš„åˆ é™¤ï¼Œä¸´æ—¶çš„è·¯å¾„ä¹Ÿä¼šè¢«åˆ é™¤ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æŒä¹…åŒ–æˆ‘ä»¬çš„æ•°æ®ã€‚

```shell
docker stop mysql
docker rm mysql
```

è¿™é‡Œçš„ `mysql` å‡æ˜¯å®¹å™¨åç§°

![docker-cli-status](/static/images/use-docker-mysql-server/docker-cli-status.png)

```shell
docker run --name mysql -d -p 3306:3306 -e MYSQL_ROOT_PASSWORD=your-pwd -v mysql:/var/lib/mysql --restart unless-stopped mysql:8
```

- `-v mysql:/var/lib/mysql`: å®¹å™¨çš„å…³è”åˆ°å®¿ä¸»çš„ `/var/lib/mysql` ä¸‹, `mysql` ä¸º Volumes åç§°

![docker-ui-volumes](/static/images/use-docker-mysql-server/docker-ui-volumes.png)

![docker-cli-volumes](/static/images/use-docker-mysql-server/docker-cli-volumes.png)

æ­¤æ—¶æˆ‘ä»¬åˆ é™¤å®¹å™¨ï¼Œè¯¥å·å®—ä¾ç„¶å­˜åœ¨

```shell
docker stop mysql
docker rm mysql
```

å¦‚æœè¦åˆ é™¤å·å®—

```shell
docker volume rm mysql
```

### å…¶ä»–

#### ä½¿ç”¨å®¹å™¨ç½‘ç»œ

åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œç«¯å£è½¬å‘ç”¨äºåœ¨ä½ çš„ä¸»æœºç½‘ç»œä¸Šå…¬å¼€ MySQL æœåŠ¡å™¨ã€‚å¦‚æœä½ åªä»å¦ä¸€ä¸ª Docker å®¹å™¨ï¼ˆä¾‹å¦‚æ‚¨çš„ API æœåŠ¡å™¨ï¼‰è¿æ¥åˆ° MySQLï¼Œæ›´å¥½çš„æ–¹æ³•æ˜¯åˆ›å»ºä¸€ä¸ªä¸“ç”¨çš„[Docker ç½‘ç»œ](https://docs.docker.com/network)ã€‚è¿™é€šè¿‡é™åˆ¶æ•°æ®åº“çš„æš´éœ²æ¥æé«˜å®‰å…¨æ€§ã€‚

é¦–å…ˆä¸ºæ‚¨çš„åº”ç”¨ç¨‹åºåˆ›å»ºä¸€ä¸ª Docker ç½‘ç»œï¼š

```shell
docker network create example-app
```

å¯åŠ¨ MySQL å®¹å™¨æ—¶æŒ‡å®šæ­¤ç½‘ç»œï¼š

```shell
docker run --name mysql -d -e MYSQL_ROOT_PASSWORD=your-pwd -v mysql:/var/lib/mysql --network example-app mysql:8
```

å°†å¦ä¸€ä¸ªå®¹å™¨è¿æ¥åˆ°åŒä¸€ä¸ªç½‘ç»œï¼š

```shell
docker run --name api-server -d -p 80:80 --network example-app example-api-server:latest
```

API å’Œ MySQL å®¹å™¨ç°åœ¨å…±äº«ä¸€ä¸ªç½‘ç»œã€‚å¯ä»¥é€šè¿‡å¼•ç”¨ MySQL å®¹å™¨çš„ä¸»æœºåä» API å®¹å™¨è¿æ¥åˆ° MySQLã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™ä¸å®¹å™¨çš„åç§°åŒ¹é…ã€‚åœ¨è¿™é‡Œï¼Œåº”ç”¨ç¨‹åºåº”è¿æ¥åˆ°`mysql`ä¸»æœºä¸Šçš„ç«¯å£ `3306`ã€‚

#### MySQL é…ç½®

å®˜æ–¹ MySQL é•œåƒæ”¯æŒå¤šä¸ªç¯å¢ƒå˜é‡ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å®ƒä»¬æ¥é…ç½®å®¹å™¨çš„åˆå§‹çŠ¶æ€ã€‚ä¾‹å¦‚ï¼Œ`MYSQL_ROOT_PASSWORD`.Â  ä½¿ç”¨ `-e` æ ‡å¿— `docker run` è®¾ç½®è¿™äº›å˜é‡ã€‚å®ƒä»¬ä»…åœ¨å®¹å™¨ç¬¬ä¸€æ¬¡å¯åŠ¨æ—¶é…ç½®ï¼Œæ­¤æ—¶ MySQL æ•°æ®ç›®å½•ä¸ºç©ºã€‚

- **`MYSQL_DATABASE`** - å®¹å™¨å¯åŠ¨æ—¶è¦åˆ›å»ºçš„æ•°æ®åº“æ¨¡å¼çš„åç§°ã€‚
- **`MYSQL_USER`-`MYSQL_PASSWORD`** å®¹å™¨å¯åŠ¨æ—¶åˆ›å»ºä¸€ä¸ªæ–°çš„æ™®é€šç”¨æˆ·ã€‚
- **`MYSQL_RANDOM_ROOT_PASSWORD`** - `MYSQL_ROOT_PASSWORD` å¦‚æœæ‚¨å¸Œæœ› MySQL `root` ä¸ºæ‚¨ç”Ÿæˆå®‰å…¨å¯†ç ï¼Œè¯·è®¾ç½®æ­¤é€‰é¡¹ã€‚å¦‚æœå¯ç”¨æ­¤è®¾ç½®ï¼Œå¯†ç å°† `docker logs` åœ¨é¦–æ¬¡å¯åŠ¨æœŸé—´å‘é€åˆ°å®¹å™¨çš„æ—¥å¿—ï¼ˆå¯é€šè¿‡å‘½ä»¤è®¿é—®ï¼‰ã€‚ä¹‹åå°†æ— æ³•æ‰¾å›å¯†ç ã€‚
